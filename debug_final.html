<!DOCTYPE html>
<html>
<head>
    <title>Debug Final Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { border: 1px solid #ccc; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { background-color: #e8f5e8; border-color: green; }
        .error { background-color: #ffe8e8; border-color: red; }
    </style>
</head>
<body>
    <h1>Debug Final Test - Mode Detection</h1>
    <div id="results"></div>
    
    <script>
        const testCases = [
            {id: "683-31450-18-57", name: "TRIAL (KHUSUS IT)", expected: "TANGGAL"},
            {id: "66-01721-10", name: "Nautika", expected: "TANGGAL"},
            {id: "72-65046-33", name: "REVALIDASI BST", expected: "TANGGAL"}
        ];
        
        async function runTest(testCase) {
            try {
                const response = await fetch(`http://localhost/tugas1_tmu1/pendaftaran/get_periode_list/${testCase.id}`);
                const data = await response.json();
                
                console.log(`Test ${testCase.name}:`, data);
                
                // Simulate exact JavaScript logic from pendaftaran.php
                const useGelombang = data.use_gelombang;
                const totalPeriode = data.total_periode;
                
                let mode;
                let labelText;
                let headingText;
                
                // This is the EXACT logic from the updated JavaScript
                if (useGelombang === true) {
                    mode = "GELOMBANG";
                    labelText = 'Pilih Gelombang Pendaftaran';
                    headingText = 'Tentukan Periode/Gelombang';
                } else {
                    mode = "TANGGAL";
                    labelText = 'Pilih Tanggal Pelaksanaan';
                    headingText = 'Tentukan Tanggal';
                }
                
                const isCorrect = mode === testCase.expected;
                
                return {
                    ...testCase,
                    total_periode: totalPeriode,
                    use_gelombang: useGelombang,
                    actual_mode: mode,
                    label: labelText,
                    heading: headingText,
                    success: isCorrect,
                    error: null
                };
                
            } catch (error) {
                return {
                    ...testCase,
                    success: false,
                    error: error.message
                };
            }
        }
        
        async function runAllTests() {
            const results = [];
            
            for (const testCase of testCases) {
                const result = await runTest(testCase);
                results.push(result);
            }
            
            // Display results
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = results.map(r => `
                <div class="test-case ${r.success ? 'success' : 'error'}">
                    <h3>${r.name} (ID: ${r.id})</h3>
                    <p><strong>Total Periode:</strong> ${r.total_periode || 'Error'}</p>
                    <p><strong>use_gelombang API:</strong> ${r.use_gelombang}</p>
                    <p><strong>Expected Mode:</strong> ${r.expected}</p>
                    <p><strong>Actual Mode:</strong> ${r.actual_mode || 'Error'}</p>
                    <p><strong>Label:</strong> ${r.label || 'Error'}</p>
                    <p><strong>Heading:</strong> ${r.heading || 'Error'}</p>
                    <p><strong>Status:</strong> ${r.success ? '✅ SUCCESS' : '❌ FAILED'}</p>
                    ${r.error ? `<p><strong>Error:</strong> ${r.error}</p>` : ''}
                </div>
            `).join('');
            
            console.table(results);
        }
        
        runAllTests();
    </script>
</body>
</html>

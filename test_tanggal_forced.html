<!DOCTYPE html>
<html>
<head>
    <title>Test Dropdown Tanggal - Forced Mode</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f0f8ff; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; }
        .forced { background: linear-gradient(45deg, #ffeb3b, #4caf50); padding: 15px; border: 3px solid #2196f3; margin: 15px 0; border-radius: 8px; }
        .result { background: #e8f5e8; padding: 15px; margin: 10px 0; border-left: 5px solid #4caf50; }
        .debug { background: #fff3e0; padding: 10px; margin: 5px 0; border-left: 4px solid #ff9800; font-family: monospace; font-size: 14px; }
        select { width: 100%; padding: 15px; font-size: 16px; margin: 10px 0; border: 2px solid #2196f3; border-radius: 5px; }
        h1 { color: #2196f3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 TEST: Mode Tanggal Dipaksa 🚀</h1>
        
        <div class="forced">
            <h2>⚡ MODE TANGGAL DIPAKSA ⚡</h2>
            <p><strong>Target:</strong> Semua dropdown harus menampilkan format 📅 TANGGAL</p>
            <p><strong>Tidak boleh ada:</strong> "PERIODE:" atau "Tanpa tanggal"</p>
        </div>
        
        <div class="result">
            <h3>📋 Hasil Dropdown:</h3>
            <select id="test-dropdown">
                <option>🔄 Loading...</option>
            </select>
        </div>
        
        <div id="debug-logs"></div>
    </div>
    
    <script>
        function addDebug(message, isSuccess = true) {
            const debugDiv = document.getElementById('debug-logs');
            const div = document.createElement('div');
            div.className = 'debug';
            div.style.borderLeftColor = isSuccess ? '#4caf50' : '#f44336';
            div.style.backgroundColor = isSuccess ? '#e8f5e8' : '#ffebee';
            div.innerHTML = '<strong>' + new Date().toLocaleTimeString() + ':</strong> ' + message;
            debugDiv.appendChild(div);
            console.log(message);
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return null;
            try {
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return null;
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                return date.getDate() + ' ' + months[date.getMonth()] + ' ' + date.getFullYear();
            } catch (e) {
                return null;
            }
        }
        
        async function testTanggalMode() {
            addDebug('🚀 Starting TANGGAL MODE test');
            
            try {
                // Test with diklat that was problematic
                const diklatId = '59-01825-89';
                const response = await fetch(`http://localhost/tugas1_tmu1/pendaftaran/get_periode_list/${diklatId}`);
                
                addDebug('📡 API Response: ' + response.status);
                
                const result = await response.json();
                
                addDebug('📊 Data: use_gelombang=' + result.use_gelombang + ', total=' + result.total_periode);
                
                const data = result.data || [];
                const dropdown = document.getElementById('test-dropdown');
                
                // FORCE TANGGAL MODE LOGIC (sama seperti di main file)
                let options = '<option value="">-- PILIH TANGGAL (FORCED) --</option>';
                
                if (data.length > 0) {
                    // Priority: data with dates
                    const withDates = data.filter(item => 
                        item.kouta > 0 && 
                        item.is_exist == 1 && 
                        item.pelaksanaan_mulai && 
                        item.pelaksanaan_akhir
                    );
                    
                    // Fallback: data without dates but valid
                    const withoutDates = data.filter(item => 
                        item.kouta > 0 && 
                        item.is_exist == 1
                    );
                    
                    let finalData = withDates.length > 0 ? withDates : withoutDates;
                    
                    addDebug('📈 With dates: ' + withDates.length + ', Without dates: ' + withoutDates.length);
                    addDebug('✅ Using ' + finalData.length + ' items for dropdown');
                    
                    if (finalData.length > 0) {
                        finalData.forEach(item => {
                            let startDate = formatDate(item.pelaksanaan_mulai);
                            let endDate = formatDate(item.pelaksanaan_akhir);
                            
                            // PAKSA FORMAT TANGGAL
                            if (!startDate || !endDate) {
                                const dateText = 'Tanggal akan ditentukan';
                                options += '<option value="' + item.periode + '">📅 ' + dateText + ' (Periode ' + item.periode + ')</option>';
                                addDebug('📅 Created dummy date for periode ' + item.periode);
                            } else {
                                const dateRange = startDate + ' - ' + endDate;
                                options += '<option value="' + item.periode + '">📅 ' + dateRange + ' (Periode ' + item.periode + ')</option>';
                                addDebug('📅 Real date for periode ' + item.periode + ': ' + dateRange);
                            }
                        });
                        
                        addDebug('🎉 SUCCESS: All options use 📅 TANGGAL format!', true);
                    } else {
                        options += '<option value="">❌ No valid data</option>';
                        addDebug('❌ No valid data found', false);
                    }
                } else {
                    options += '<option value="">❌ No data from API</option>';
                    addDebug('❌ No data from API', false);
                }
                
                dropdown.innerHTML = options;
                
                // Count how many options have tanggal format
                const tanggalCount = (options.match(/📅/g) || []).length;
                const periodeCount = (options.match(/PERIODE:/g) || []).length;
                
                addDebug('📊 RESULT: ' + tanggalCount + ' tanggal options, ' + periodeCount + ' periode options');
                
                if (periodeCount === 0 && tanggalCount > 0) {
                    addDebug('🎉 PERFECT! All options use TANGGAL format!', true);
                } else if (periodeCount > 0) {
                    addDebug('⚠️ WARNING: Still showing PERIODE format!', false);
                }
                
            } catch (error) {
                addDebug('❌ Error: ' + error.message, false);
            }
        }
        
        // Start test when page loads
        window.onload = testTanggalMode;
    </script>
</body>
</html>
